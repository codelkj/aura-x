import React from 'react';
import { Card } from '@/components/ui/card.jsx';
import { Slider } from '@/components/ui/slider.jsx';
import { Progress } from '@/components/ui/progress.jsx';

/**
 * Dubler 2.0 Styled Components
 * These components replicate the exact look and feel of Vochlea Dubler 2.1
 */

// Dubler-style Radial Pitch Wheel
export const DublerPitchWheel = ({ currentNote, currentPitch, selectedKey, selectedScale, isListening }) => {
  const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
  const scaleNotes = getScaleNotes(selectedKey, selectedScale);
  
  return (
    <div className="relative w-full max-w-lg mx-auto p-8">
      {/* Outer glow effect */}
      <div className="absolute inset-0 bg-gradient-radial from-purple-600/20 via-transparent to-transparent blur-2xl" />
      
      {/* Main wheel container */}
      <div className="relative aspect-square">
        {/* Background circles */}
        <div className="absolute inset-0 rounded-full border border-gray-700/50" />
        <div className="absolute inset-4 rounded-full border border-gray-600/30" />
        <div className="absolute inset-8 rounded-full border border-gray-500/20" />
        
        {/* Note markers */}
        <svg className="absolute inset-0 w-full h-full" viewBox="0 0 200 200">
          {notes.map((note, index) => {
            const angle = (index * 30) - 90;
            const radian = (angle * Math.PI) / 180;
            const radius = 85;
            const x = 100 + radius * Math.cos(radian);
            const y = 100 + radius * Math.sin(radian);
            
            const isActive = note === currentNote && isListening;
            const isInScale = scaleNotes.includes(note);
            
            return (
              <g key={note}>
                {/* Connection line */}
                {isInScale && (
                  <line
                    x1="100"
                    y1="100"
                    x2={x}
                    y2={y}
                    stroke={isActive ? '#a855f7' : '#374151'}
                    strokeWidth={isActive ? '2' : '0.5'}
                    opacity={isActive ? '0.6' : '0.2'}
                  />
                )}
                
                {/* Note circle */}
                <circle
                  cx={x}
                  cy={y}
                  r={isActive ? '12' : '8'}
                  fill={isActive ? 'url(#activeGradient)' : isInScale ? '#4b5563' : '#1f2937'}
                  stroke={isActive ? '#ec4899' : isInScale ? '#6b7280' : '#374151'}
                  strokeWidth="2"
                  className="transition-all duration-150"
                />
                
                {/* Note label */}
                <text
                  x={x}
                  y={y}
                  textAnchor="middle"
                  dominantBaseline="middle"
                  fill={isActive ? '#ffffff' : isInScale ? '#d1d5db' : '#6b7280'}
                  fontSize={isActive ? '10' : '8'}
                  fontWeight={isActive ? 'bold' : 'normal'}
                  className="transition-all duration-150"
                >
                  {note}
                </text>
              </g>
            );
          })}
          
          {/* Gradient definitions */}
          <defs>
            <linearGradient id="activeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stopColor="#a855f7" />
              <stop offset="100%" stopColor="#ec4899" />
            </linearGradient>
          </defs>
        </svg>
        
        {/* Center display */}
        <div className="absolute inset-0 flex items-center justify-center">
          <div className="text-center">
            {/* Current note */}
            <div className={`text-7xl font-bold transition-all duration-150 ${
              isListening && currentNote
                ? 'bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent scale-110'
                : 'text-gray-600'
            }`}>
              {currentNote || 'â€”'}
            </div>
            
            {/* Octave indicator */}
            {currentNote && (
              <div className="text-sm text-gray-400 mt-1">
                Octave {Math.floor(currentPitch / 12)}
              </div>
            )}
            
            {/* Key/Scale info */}
            <div className="mt-4 px-4 py-2 bg-gray-800/50 rounded-full border border-gray-700">
              <div className="text-xs text-gray-400">{selectedKey} {selectedScale}</div>
            </div>
            
            {/* Pitch value */}
            {isListening && (
              <div className="mt-2 text-xs text-gray-500">
                MIDI: {Math.round(currentPitch)}
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

// Dubler-style Trigger Pad
export const DublerTriggerPad = ({ pad, isListening, onTrigger }) => {
  const [isActive, setIsActive] = React.useState(false);
  
  React.useEffect(() => {
    if (isListening && Math.random() > 0.97) {
      setIsActive(true);
      onTrigger?.(pad);
      setTimeout(() => setIsActive(false), 150);
    }
  }, [isListening, pad, onTrigger]);
  
  const colorMap = {
    orange: { bg: 'bg-orange-600', border: 'border-orange-400', glow: 'shadow-orange-500/50' },
    blue: { bg: 'bg-blue-600', border: 'border-blue-400', glow: 'shadow-blue-500/50' },
    red: { bg: 'bg-red-600', border: 'border-red-400', glow: 'shadow-red-500/50' },
    yellow: { bg: 'bg-yellow-600', border: 'border-yellow-400', glow: 'shadow-yellow-500/50' },
    green: { bg: 'bg-green-600', border: 'border-green-400', glow: 'shadow-green-500/50' },
    purple: { bg: 'bg-purple-600', border: 'border-purple-400', glow: 'shadow-purple-500/50' }
  };
  
  const colors = colorMap[pad.color] || colorMap.blue;
  
  return (
    <div
      className={`relative p-6 rounded-xl border-2 transition-all duration-150 cursor-pointer select-none ${
        isActive
          ? `${colors.bg} ${colors.border} scale-95 shadow-2xl ${colors.glow}`
          : 'bg-gray-800/80 border-gray-700 hover:border-gray-600 hover:bg-gray-800'
      }`}
      onClick={() => {
        setIsActive(true);
        onTrigger?.(pad);
        setTimeout(() => setIsActive(false), 150);
      }}
    >
      {/* Pad name */}
      <div className="text-center">
        <div className={`text-lg font-bold mb-1 transition-colors ${
          isActive ? 'text-white' : 'text-gray-300'
        }`}>
          {pad.name}
        </div>
        <div className={`text-xs transition-colors ${
          isActive ? 'text-white/80' : 'text-gray-500'
        }`}>
          MIDI {pad.midiNote}
        </div>
      </div>
      
      {/* Visual feedback ring */}
      {isActive && (
        <div className="absolute inset-0 rounded-xl border-4 border-white/30 animate-ping" />
      )}
    </div>
  );
};

// Dubler-style Circular Vowel Meter
export const DublerVowelMeter = ({ vowel, value, ccMap }) => {
  const circumference = 2 * Math.PI * 45; // radius = 45
  const strokeDashoffset = circumference - (value / 100) * circumference;
  
  return (
    <div className="flex flex-col items-center gap-2">
      {/* Circular meter */}
      <div className="relative w-24 h-24">
        <svg className="w-full h-full transform -rotate-90">
          {/* Background circle */}
          <circle
            cx="48"
            cy="48"
            r="45"
            stroke="#374151"
            strokeWidth="6"
            fill="none"
          />
          
          {/* Progress circle */}
          <circle
            cx="48"
            cy="48"
            r="45"
            stroke="url(#vowelGradient)"
            strokeWidth="6"
            fill="none"
            strokeDasharray={circumference}
            strokeDashoffset={strokeDashoffset}
            strokeLinecap="round"
            className="transition-all duration-150"
          />
          
          <defs>
            <linearGradient id="vowelGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stopColor="#8b5cf6" />
              <stop offset="100%" stopColor="#ec4899" />
            </linearGradient>
          </defs>
        </svg>
        
        {/* Center label */}
        <div className="absolute inset-0 flex items-center justify-center">
          <div className="text-center">
            <div className="text-2xl font-bold text-white uppercase">{vowel}</div>
            <div className="text-xs text-gray-400">{Math.round(value)}</div>
          </div>
        </div>
      </div>
      
      {/* CC mapping info */}
      <div className="text-xs text-gray-500 text-center">
        {ccMap || 'CC 74'}
      </div>
    </div>
  );
};

// Dubler-style Keyboard Input
export const DublerKeyboard = ({ selectedKey, setSelectedKey, selectedScale, setSelectedScale }) => {
  const whiteKeys = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
  const blackKeys = [
    { note: 'C#', position: 0.7 },
    { note: 'D#', position: 1.7 },
    { note: 'F#', position: 3.7 },
    { note: 'G#', position: 4.7 },
    { note: 'A#', position: 5.7 }
  ];
  
  return (
    <div className="relative w-full max-w-md mx-auto mt-4">
      <div className="relative h-32 flex">
        {/* White keys */}
        {whiteKeys.map((key, index) => (
          <button
            key={key}
            onClick={() => setSelectedKey(key)}
            className={`flex-1 border-2 rounded-b-lg transition-all ${
              selectedKey === key
                ? 'bg-gradient-to-b from-purple-600 to-purple-700 border-purple-400 text-white'
                : 'bg-gradient-to-b from-gray-100 to-gray-200 border-gray-400 text-gray-800 hover:from-gray-200 hover:to-gray-300'
            }`}
          >
            <div className="h-full flex items-end justify-center pb-2">
              <span className="text-sm font-bold">{key}</span>
            </div>
          </button>
        ))}
        
        {/* Black keys */}
        {blackKeys.map(({ note, position }) => (
          <button
            key={note}
            onClick={() => setSelectedKey(note)}
            className={`absolute w-[8%] h-20 top-0 rounded-b-lg border-2 transition-all ${
              selectedKey === note
                ? 'bg-gradient-to-b from-purple-800 to-purple-900 border-purple-600 text-white'
                : 'bg-gradient-to-b from-gray-800 to-gray-900 border-gray-700 text-gray-200 hover:from-gray-700 hover:to-gray-800'
            }`}
            style={{ left: `${(position / 7) * 100}%` }}
          >
            <div className="h-full flex items-end justify-center pb-1">
              <span className="text-xs font-bold">{note}</span>
            </div>
          </button>
        ))}
      </div>
    </div>
  );
};

// Dubler-style Sensitivity Slider
export const DublerSensitivitySlider = ({ value, onChange, label }) => {
  return (
    <div className="space-y-2">
      <div className="flex items-center justify-between">
        <label className="text-sm font-medium text-gray-300">{label}</label>
        <span className="text-sm text-gray-500">{Math.round(value * 100)}%</span>
      </div>
      
      <div className="relative">
        {/* Track background */}
        <div className="h-2 bg-gray-700 rounded-full overflow-hidden">
          {/* Filled portion */}
          <div
            className="h-full bg-gradient-to-r from-purple-600 to-pink-600 transition-all duration-150"
            style={{ width: `${value * 100}%` }}
          />
        </div>
        
        {/* Slider input */}
        <input
          type="range"
          min="0"
          max="100"
          value={value * 100}
          onChange={(e) => onChange(parseFloat(e.target.value) / 100)}
          className="absolute inset-0 w-full opacity-0 cursor-pointer"
        />
        
        {/* Thumb indicator */}
        <div
          className="absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-white rounded-full border-2 border-purple-500 shadow-lg pointer-events-none transition-all duration-150"
          style={{ left: `calc(${value * 100}% - 8px)` }}
        />
      </div>
    </div>
  );
};

// Dubler-style Input Level Meter
export const DublerInputMeter = ({ level, label }) => {
  const segments = 20;
  const activeSegments = Math.floor((level / 100) * segments);
  
  return (
    <div className="space-y-2">
      <label className="text-sm font-medium text-gray-300">{label}</label>
      <div className="flex gap-1 h-8">
        {Array.from({ length: segments }).map((_, index) => {
          const isActive = index < activeSegments;
          const isRed = index >= segments * 0.8;
          const isYellow = index >= segments * 0.6 && index < segments * 0.8;
          
          let color = 'bg-gray-700';
          if (isActive) {
            if (isRed) color = 'bg-red-500';
            else if (isYellow) color = 'bg-yellow-500';
            else color = 'bg-green-500';
          }
          
          return (
            <div
              key={index}
              className={`flex-1 rounded-sm transition-all duration-75 ${color}`}
            />
          );
        })}
      </div>
    </div>
  );
};

// Helper function to get scale notes
function getScaleNotes(key, scale) {
  const allNotes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
  const keyIndex = allNotes.indexOf(key);
  
  const scalePatterns = {
    'Major': [0, 2, 4, 5, 7, 9, 11],
    'Minor': [0, 2, 3, 5, 7, 8, 10],
    'Dorian': [0, 2, 3, 5, 7, 9, 10],
    'Phrygian': [0, 1, 3, 5, 7, 8, 10],
    'Lydian': [0, 2, 4, 6, 7, 9, 11],
    'Mixolydian': [0, 2, 4, 5, 7, 9, 10],
    'Pentatonic': [0, 2, 4, 7, 9]
  };
  
  const pattern = scalePatterns[scale] || scalePatterns['Minor'];
  
  return pattern.map(interval => {
    const noteIndex = (keyIndex + interval) % 12;
    return allNotes[noteIndex];
  });
}

export default {
  DublerPitchWheel,
  DublerTriggerPad,
  DublerVowelMeter,
  DublerKeyboard,
  DublerSensitivitySlider,
  DublerInputMeter
};

